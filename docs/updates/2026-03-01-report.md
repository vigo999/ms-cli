# ms-cli Report — 2026-03-01 ~ 2026-03-02

## Day 1 (2026-03-01): Foundation

### Completed

- Implemented minimal `ms-cli` runtime loop:
  - Task/Event types
  - Agent engine
  - Executor stub
  - Interactive CLI prompt loop
- Updated module/import baseline to `github.com/vigo999/ms-cli`
- Built production-structured roadmap engine (`internal/project/roadmap.go`):
  - Load YAML, validate schema
  - Compute per-phase and overall progress
  - JSON-friendly output
  - Safe handling for unknown milestone status
- Added CLI roadmap command: `roadmap status [path]`
- Implemented weekly update system using Markdown + YAML front matter:
  - Parser in `internal/project/weekly.go`
  - CLI command `weekly status <path>`
  - Template in `docs/updates/WEEKLY_TEMPLATE.md`
- Created public roadmap page: `docs/roadmap/ROADMAP.md`

### Validation

- `go build ./...` passes
- `go run ./app` verified:
  - `roadmap status roadmap.yaml` returns correct computed JSON
  - `weekly status docs/updates/WEEKLY_TEMPLATE.md` returns parsed JSON
  - Standard task input returns `Executed: <input>`

### Operational Notes

- Go installation required environment workarounds (disk/proxy)
- Reliable run command uses cleared proxy env + temporary Go cache paths when needed

---

## Day 2 (2026-03-02): TUI Integration & Review Fixes

### Overview

Rewired the app layer to replace the bufio REPL with a Bubble Tea TUI, resolved merge conflicts, and addressed two rounds of code review findings.

### App Layer Rewire

Replaced the CLI REPL with Bubble Tea TUI by writing four new files in `app/`:

| File | Purpose |
|------|---------|
| `app/wire.go` | `Application` struct holding `Engine`, `EventCh`, `Demo`, `WorkDir`, `RepoURL`, and `Version` constant |
| `app/bootstrap.go` | Wires `executor.Run` into engine, resolves working dir via `os.Getwd`, returns `Application` |
| `app/run.go` | Two modes: `--demo` (fake event loop) and real (TUI + engine bridge via `UserCh`) |
| `app/commands.go` | Slash commands `/roadmap status [path]` and `/weekly status [path]` using `internal/project` |

`app/main.go` updated to accept `--demo` flag and call `Bootstrap(demo)`.

### User Input Wiring

- Added `userCh chan<- string` to `ui.App`
- On Enter, input sent to both chat display and channel
- `app/run.go` creates channel, passes to `ui.New`, reads in `inputLoop` -> `processInput` -> engine or slash commands
- Demo mode passes `nil` (no forwarding)

### Worktree Cleanup

- Removed `.claude/worktrees/tui-build` and deleted `feat/tui` branch
- Only `main` branch remains

### Code Review Round 1 — 3 Fixes

| Issue | Fix |
|-------|-----|
| `go.mod` unmerged conflict entries in git index | `git add go.mod go.sum` cleared conflict state |
| Blocking `userCh <- val` could freeze UI | Changed to `select`/`default` — drops input if buffer full |
| Usage text says `<path>` required but code defaults | Changed to `[path] (default: roadmap.yaml)` / `(default: weekly.md)` |

### Code Review Round 2 — 5 Fixes

| Issue | Fix |
|-------|-----|
| Scroll snap-back during live updates | `SetContent`/`Append` check `AtBottom()` — only auto-follow when already at bottom |
| Hint bar advertises unimplemented shortcuts | Removed `ctrl+l`, `ctrl+g`; kept `/` commands, `pgup/pgdn` scroll, `ctrl+c` quit |
| No keyboard scrolling | `pgup`, `pgdown`, `up`, `down`, `home`, `end` forwarded to viewport |
| Hardcoded version and path shortening | Version injected via `State.Version`; `shortenPath` uses `os.UserHomeDir()` |
| Loop-based string concatenation in hot paths | `chatLine()` and `repeatChar()` use `strings.Repeat` |

### Build Verification

- `go build` and `go vet` pass cleanly
- Binary: 4.8MB arm64

### Files Modified

```
app/main.go              app/wire.go             app/bootstrap.go
app/run.go               app/commands.go         ui/app.go
ui/model/model.go        ui/components/viewport.go
ui/panels/topbar.go      ui/panels/hintbar.go
```

---

## Current Status

- CLI baseline and status observability foundation in place
- TUI integrated with engine, demo mode functional
- Real mode works but engine is still a stub

## Next Steps

1. Move canonical roadmap to `docs/roadmap/roadmap.yaml`
2. Make `roadmap status` default to docs path (with fallback)
3. Add tests for roadmap/weekly parsers and validation logic
4. Replace placeholder roadmap owners and publish first real weekly update
5. Implement real engine logic to replace the executor stub

## How to Run

```bash
cd /Users/weizheng/work/tmp/agent-project/ms-cli
PATH="/tmp/go/bin:$PATH" ./ms-cli --demo    # fake events preview
PATH="/tmp/go/bin:$PATH" ./ms-cli            # real mode (engine is still a stub)
```
